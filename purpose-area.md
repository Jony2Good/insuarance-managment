# НАЗНАЧЕНИЯ И ЗОНА ОТВЕТСТВЕННОСТИ СЕРВИСОВ

**1. Сервис аутентификации**
   - Название контекста: Authentication Service
   - Стратегическая классификация: Supporting Subdomain
   - Описание контекста: обеспечивает идентификацию клиентов, выдачу токенов и управление доступом
   - Бизнес правила контекста:
	- Регистрация клиентов:
		- Пользователи предоставляют: имя, адрес электронной почты (уникальный), пароль  (минимум 8 символов, с требованиями к сложности), подтверждение пароля.
		- Регистрация завершается вводом пароля и его подтверждением, а также нажатием на кнопку "Зарегистрироваться".
	- Вход в приложение:
		- Пользователи предоставляют: адрес электронной почты и пароль.
		- После успешного входа выдается JWT-токен с ограниченным сроком действия.
	- Валидация токенов:
		- Все запросы к другим сервисам проходят проверку токена через API Gateway.
   - Общий язык контекста: ФИО, email, пароль, JWT токен, регистрация, аутентификация, авторизация, проверка токена
   - Возможности и ответственность:
	- Запрос информации:
		- Проверка валидности JWT-токена (POST /validate_token).
		- Предоставление профиля клиента (имя, email) другим сервисам.
	- Действия:
		- Регистрация нового клиента (создание учетной записи).
		- Аутентификация (выдача JWT-токена).
   - Внешние и внутренние зависимости:
   - 
     	- Внутренние:
		- Сервис уведомлений (письмо о регистрации):
			- Отправка писем для подтверждения регистрации ("user_registered").
		- Сервис личного кабинета (создание профиля пользователя):
			- Создание профиля пользователя после регистрации ("user_registered").
   
	- Внешние: отсутствуют

**2. Сервис личного кабинета**
   - Название контекста: Account Service
   - Стратегическая классификация: Core Domain
   - Описание контекста: управляет персональными данными пользователя, его виртуальным счетом и историей полисов. Отвечает за хранение информации, необходимой для идентификации клиента и совершения финансовых операций.
   - Бизнес правила контекста:
	- Каждый пользователь имеет один персональный профиль и один виртуальный счет.
	- Допускается редактирование ФИО, email и пароля.
	- Пополнение виртуального счета возможно только после успешной авторизации.
	- Все операции с виртуальным счетом логируются.
	- Запрещено списание средств без явного подтверждения клиента.
	- Данные о полисе (активные, завершенные) доступны пользователю через интерфейс.
   - Общий язык контекста: Профиль пользователя, виртуальный счет, баланс, ФИО, email, телефон, паспортные данные, история транзакций, документы.
   - Возможности и ответственность:
	- Запрос информации:
		- Предоставление персональных данных по user_id (GET /me).
		- Предоставление баланса и истории транзакций (GET /bills).
		- Получение списка полисов пользователя (GET /policies).
	- Действия:
		- Создание профиля и счета после регистрации (событие "billing_event").
		- Обновление персональных данных (PUT /me).
		- Пополнение счета (POST /bills).
		- Списание средств (событие "money_debt").
		- Загрузка документов (POST /documents).
   - Внешние и внутренние зависимости
	- Внутренние:
		- Authentication Service (создание аккаунта). Получение данных о новом пользователе ("user_registered").
		- Billing Service (списание средств). Списание средств для оплаты полисов (событие "billing_event")
		- Notification Service (уведомления о действиях). Уведомления о пополнении счета, изменении данных ("account_funded", "user_updated").
		- Сервис оформления полисов: Получение данных о полисе для отображения (событие "policy_event").
	- Внешние: отсутствуют

**3. Сервис оформления полисов**
   - Название контекста: Policy Service
   - Стратегическая классификация: Core Domain
   - Описание контекста: управляет процессом создания, редактирования и хранения страховых договоров ОСАГО.
   - Бизнес правила контекста:
	- Каждый договор оформляется только после успешного расчета стоимости.
	- Договор создается только после успешной проверки ТС и расчета стоимости.
	- Договор можно редактировать только до момента оплаты.
	- У каждого договора есть статус (черновик, ожидает оплаты, оформлен, отклонен).
   - Общий язык контекста: договор, полис, черновик, статус оформления.
   - Возможности и ответственность:
	- Запрос информации:
		- Получение списка договоров пользователя (GET /me).
		- Проверка статуса оформления (GET /me/{id}).
	- Действия:
		- Создание нового договора (POST /policies).
		- Редактирование черновика (PUT /policies/{policy_id}).
		- Обновление статуса договора (PUT /policies/{policy_id}).
   - Внешние и внутренние зависимости
	- Внутренние:
		- Authentication Service. Все запросы проходят валидацию токена через API Gateway.
		- Calculation Service. Получение стоимости полиса (событие "calc_event").
		- Vehicle Verification Service. Инициирует проверку транспортного средства перед расчетом (событие "vechicle_verify_event").
		- Billing Service. Подтверждение оплаты для активации полиса (событие "payment_completed").
		- Storage Service. Передача данных для генерации PDF (событие "storage_event").
		- Notification Service: Уведомления об изменении статуса полиса ("policy_created", "policy_cancelled").
	- Внешние: отсутствуют

**4. Сервис расчета полисов**
   - Название контекста: Calculation Service
   - Стратегическая классификация: Core Domain
   - Описание контекста: отвечает за расчет стоимости страхового полиса на основе данных клиента, параметров ТС и тарифов.
   - Бизнес правила контекста:
	- Стоимость рассчитывается на основе фиксированных тарифов, параметров ТС, возраста и стажа водителя.
	- Проверка автомобиля обязательна перед расчетом.
	- Расчет выполняется только после успешной проверки ТС.
	- Стоимость зависит от:
		- Данных ТС (мощность, год выпуска, регион).
		- Данных клиента (возраст, стаж вождения, коэффициент бонус-малус).
		- Актуальных тарифов (хранятся в базе или запрашиваются через API).
   - Общий язык контекста:  расчет, стоимость, КБМ, тариф, валидность
   - Возможности и ответственность:
	- Запрос информации:
		- Получение информации о статусе расчета (GET /calculations/{calculation_id}).
	- Действия:
		- Расчет стоимости (POST /calculate).
		- Проверка валидности расчетов перед оплатой.
   - Внешние и внутренние зависимости
	- Внутренние:
		- Policy Service. Передача результатов расчета (событие "calc_policy_event").
		- Account Service. Получение данных клиента (событие "calc_user_event").
		- Vehicle Verification Service. Проверка ТС перед расчетом (событие "policy_verify_event").
	- Внешние: отсутствуют

**5. Сервис оплаты полисов**
   - Название контекста: Billing Service
   - Стратегическая классификация: Core Domain (Orchestrator)
   - Описание контекста: координирует процесс оплаты полисов, включая проверку расчета, списание средств и интеграцию с платежными системами.
   - Бизнес правила контекста:
	- Оплата возможна только при валидном расчете и наличии достаточного баланса.
	- Списание средств возможно только после подтверждения пользователя.
	- Процесс завершается только после подтверждения всех этапов: списания средств, генерации и сохранения полиса, а также уведомления пользователя.
   - Общий язык контекста:  оплата, списание, успешная транзакция, ошибка оплаты.
   - Возможности и ответственность:
	- Запрос информации:
		- Проверка валидности расчета и статуса договора (событие "billing_policy_event").
		- Запрос баланса пользователя (событие "billing_money_event")
	- Действия:
		- Списание средств с виртуального счета.
		- Обработка возвратов.
		- Инициирование активации полиса после подтвержденной оплаты.
		- Уведомление клиента о результате.
		- Передача данных для генерации полиса ("payment_completed").
   - Внешние и внутренние зависимости
	- Внутренние:
		- Calculation Service. Проверка актуальности расчета (событие "billing_calc_event").
		- Policy Service. Подтверждение оплаты для активации полиса. (событие "billing_policy_event").
		- Account Service. Проверка баланса и списание средств (событие "billing_money_event").
		- Storage Service. Передача данных для генерации PDF (событие "billing_storage_event").
		- Notification Service. Уведомления об оплате и ошибках (событие "billing_payment_completed", "billing_payment_failed").
	- Внешние: отсутствуют

**6. Сервис хранения и печати документов**
   - Название контекста: Storage Service
   - Стратегическая классификация: Supporting Subdomain
   - Описание контекста: хранит сканы и генерирует PDF-документы полисов на основании данных из других сервисов.
   - Бизнес правила контекста:
	- Доступ к документам осуществляется только по защищенным запросам от доверенных сервисов.
	- Каждый сгенерированный полис должен быть сохранен с уникальным идентификатором.
	- PDF-полисы генерируются на основе шаблонов с данными из сервиса оформления полисов.
   - Общий язык контекста: PDF, полис, документ, скан.
   - Возможности и ответственность:
	- Запрос информации:
		- Получение документа по ID (GET /me/{id}).
		- Получение списка документов пользователя (GET /me).
	- Действия:
		- Генерация и сохранение PDF-полиса на основе переданных данных (событие "storage_policy_event").
		- Сохранение загруженных документов (событие "storage_scans_event").
		- Отправка документа в Notification Service (событие "storage_notify_event").
   - Внешние и внутренние зависимости
	- Внутренние:
		- Policy Service. Получение данных для генерации полиса (событие "storage_policy_event").
		- Billing Service. Триггер для генерации PDF после оплаты (событие "policy_storage_event").
		- Notification Service. Отправка PDF пользователю (событие "storage_policy_event").
	- Внешние:
		- Облачное хранилище (например, AWS S3) для хранения файлов.

**7. Сервис проверки авто**
   - Название контекста: Vehicle Verification Service
   - Стратегическая классификация: Generic Subdomain
   - Описание контекста: выполняет проверку транспортного средства по внешним API (например, ГИБДД).
   - Бизнес правила контекста:
	- Проверка авто обязательна перед оформлением полиса.
	- Все запросы логгируются.
   - Общий язык контекста:   VIN, госномер, результат проверки, ГИБДД.
   - Возможности и ответственность:
	- Запрос информации:
		- Проверка состояния ТС по VIN или госномеру.
	- Действия:
		- Запрос к внешним API.
   - Внешние и внутренние зависимости
	- Внутренние:
		- Calculation Service. Инициатор события. Передача результатов проверки для расчета.
	- Внешние:
		- API ГИБДД или иные сторонние источники информации о ТС.

**8. Сервис уведомлений**
 - Название контекста: Notification Service
 - Стратегическая классификация: Generic Subdomain
 - Описание контекста: Отправляет сообщения пользователю о различных событиях в системе.
 - Бизнес-правила контекста:
	- Уведомления отправляются в реальном времени.
	- Уведомления направляются пользователю в следующих случаях:
		- при регистрации в системе (Authentication Service);
		- изменения данных в личном кабинете (Account Service);
		- пополнении вирутального счета (Account Service);
		- ошибках при оплате и оформлении полиса (Policy Service);
		- направлении pdf полиса (Storage Service)
 - Общий язык контекста: уведомление, push-сообщение, email
 - Возможности и ответственность:
 	- Запрос информации: Нет.
 	- Действия: Отправка сообщений.
 - Внешние и внутренние зависимости: 
	- Внутренние:
		- Authentication Service. Уведомления о регистрации.
		- Account Service. Уведомления об изменении данных и операциях со счетом.
		- Policy Service. Уведомления о статусе полиса.
		- Billing Service. Уведомления об оплате.
		- Storage Service. Отправка уведомления о готовности полиса с PDF во вложении.
	- Внешние: Push-сервис, SMTP, SMS-провайдер.
