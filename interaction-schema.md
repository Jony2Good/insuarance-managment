# Описание сервисов и общая схема взаимодействия восьми сервисов

### Сервис аутентификации

*Основная функция:*

1. Регистрирует, аутентифицирует и авторизует пользователей.
2. Валидирует токены в запросах к другим сервисам (через JWT и middleware). Другие сервисы доверяют токену, подписанному этим сервисом.
3. Управляет сессиями (логаут, инвалидация токенов).
4. Для проверки токенов используется API Gateway, который будет вызывать сервис аутентификации для валидации токенов перед маршрутизацией запросов.

*Взаимодействие с сервисами:*

- Направляет информацию о факте регистрации клиента в сервис уведомлений (отправка корреспонденции) и личный кабинет (создание аккаунта и счета). 

### Сервис личного кабинета

*Основная функция:*

1. Хранит личные данные клиента (например, ФИО, адрес, паспортные данные, контактная информация).
2. Управляет внутренним виртуальным счетом клиента для оплаты полисов (можно пополнить через личный кабинет).
3. Содержит информацию о персонализированном счете, который используется для оплаты оформленных полисов.

*Взаимодействие с сервисами:*

- Предоставляет данные о клиенте по ID при межсервисных вызовах. 
- Списывает средства с виртуального счета по запросу сервиса оплаты полисов.

### Сервис оформления полисов

*Основная функция:*

1. Создание страхового договора на основе данных клиента и ТС.
2. Поддержка продления или расторжения полисов.
3. Сохранение и предоставление информации о них другим сервисам.

Взаимодействие с сервисами:
- Предоставляет другим сервисам данные об оформленных договорах по запросу.

### Сервис расчета полисов

*Основная функция:*

1. Расчет полиса на основе:
	- Данных о клиенте (возраст, стаж вождения, история страховых случаев).
	- Данных о ТС (марка, модель, год выпуска, VIN).
	- Региона регистрации и статистики ДТП.
	- Тарифов и скидок.
2. Проверка корректности введенных данных (например, через сервис проверки авто).
3. Генерация уникального номера полиса.  
4. Управление статусами полиса (черновик, на рассмотрении, оформлен, аннулирован). 
5. Формирует итоговую стоимость полиса с учетом различных критериев.
6. Поддерживает актуальные тарифы страхования и правила расчета стоимости.

*Взаимодействие с сервисами:*

- Предоставляет рассчитанную стоимость полиса и статус расчета.
- Запрашивает данные о клиенте в сервисе личного кабинета.
- Направляет запрос в сервис проверки авто.

### Сервис оплаты полисов

*Основная функция:*

1. Выступает основным оркестратором процедуры оформления полиса.
2. Инициирует процесс оформления полиса, проверяет расчёт, наличие средств, выполняет списание и уведомление клиента, а также отправляет данные для генерации полиса.
3. Реализует механизм отката тразакции в случае неуспешности операции.

*Взаимодействие с сервисами:*

1. Запрашивает:
	- сервис расчета о статусе полиса;
	- сервис личного кабинета о наличии денежных средств для оплаты полиса;
	- направляет информацию о статусе оплаты в сервис уведомлений;
	- передает информацию в сервис хранения и печати документов на изготовление полиса.

### Сервис хранения и печати документов

*Основная функция:*

1. Хранит загруженные документы клиента.
2. Выполняет генерацию страховых полисов в PDF на основе данных из сервиса оформления.

*Взаимодействие с сервисами:*

- Получает данные для генерации документа в формате pdf. 
- Направляет изготовленный полис в сервис уведомлений для отправки клиенту.

### Сервис проверки авто

*Основная функция:*

1. Получает запрос на проверку ТС, обращается к внешним API (например, ГИБДД).
2. Возвращает результат проверки в вызывающий сервис (например, расчёта полиса).

*Взаимодействие с сервисами:*

- На основе данных (VIN, гос. номер и т.д.) выполняет проверку по внешним API и возвращает результат в вызывающий сервис.

### Сервис уведомлений

*Основная функция:*

1. Принимает запросы от всех сервисов и отправляет сообщения клиентам (push, email, SMS).

*Взаимодействие с сервисами:*

- Не инициирует запросы самостоятельно.
- Поддерживает шаблоны уведомлений и очередь сообщений (например, через RabbitMQ).
